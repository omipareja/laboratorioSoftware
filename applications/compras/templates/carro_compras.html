{% extends 'base.html' %}

{% block title %} <title>Carrito de compras | Librería UTP</title> {% endblock %}

{% block content %}

<div class="container my-3">
    <div class="row mb-2">
        <div class="col">
            <h1 class="text-center">Carrito de Compras</h1>
        </div>
    </div>
    {% if productos %}
        <div class="row">
            <div class="col">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th class="text-center">Precio Unitario</th>
                                <th class="text-center">Cantidad</th>
                                <th class="text-center">Operaciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in productos %}
                                <tr>
                                    <td>{{p.productos.titulo}}</td>
                                    <td class="text-center">{{p.productos.precio}}</td>
                                    <td class="text-center">{{p.cantidad}}</td>
                                    <td class="text-center">
                                        <form method="post" action="{% url 'compras:sumar_producto' p.pk  %}"  style="display:inline;">
                                            <button class="btn btn-warning" role="button" type="submit"><i class="fas fa-plus"></i></button>{% csrf_token %}
                                        </form>
                                        <form method="post" action="{% url 'compras:restar_producto' p.pk  %}" style="display:inline;" >{% csrf_token %}
                                            <button class="btn btn-primary mx-2" role="button"  type="submit"><i class="fas fa-minus"></i></button>
                                        </form>
                                        <form method="post" action="{% url 'compras:eliminar_producto' p.pk  %}" style="display:inline;" >{% csrf_token %}
                                            <button class="btn btn-danger" role="button" type="submit"><i class="far fa-trash-alt"></i></button>
                                        </form>

                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
            <div class="row">
                <form method="post" action="{% url 'compras:mostrar_carro'%}">{% csrf_token %}
                    <div class="col">
                        <p>Para procesar tu pedido, por favor ingresa tú número de tarjeta:</p>
                        {{ form.metodo }}
                    </div>
                    <div class="col text-end d-lg-flex justify-content-lg-end align-items-lg-center">
                        <h2>Total: ${{ total }}</h2>
                    </div>
                    <button class="btn btn-success mx-2" type="submit">Pagar</button>
                </form>
            </div>
            <div class="row">
                <div class="col text-end my-2">
                    <form method="post" action="{% url 'compras:vaciar_carro' %}"  >{% csrf_token %}
                        <button class="btn btn-danger mx-2" role="button" type="submit">Vaciar carrito</button>
                    </form>
                </div>
            </div>
        {% if messages %}
            {% for message in messages %}
            <div class="row">
                <div class="col">
                    <div role="alert" class="alert alert-warning text-center"><span><strong>{{ message }}</strong><br /></span></div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    {% else %}
        <div class="row">
            <div class="col">
                <div role="alert" class="alert alert-info text-center"><span><strong>¡Aún no has agregado articulos al carrito!</strong><br /></span></div>
            </div>
        </div> 
    {% endif %}
</div>

{% endblock %}